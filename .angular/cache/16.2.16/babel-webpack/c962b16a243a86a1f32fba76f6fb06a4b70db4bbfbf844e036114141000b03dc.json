{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../bookmarks/services/bookmarks.service\";\nimport * as i3 from \"src/app/features/comic/services/comic.service\";\nimport * as i4 from \"ngx-cookie-service\";\nimport * as i5 from \"../../auth/services/auth.service\";\nimport * as i6 from \"ngx-toastr\";\nimport * as i7 from \"../../rating/services/rating.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"../../comment/user-reply/user-reply.component\";\nimport * as i10 from \"../../comment/user-comment/user-comment.component\";\nconst _c0 = function (a0, a1, a2) {\n  return {\n    \"bi-star-fill\": a0,\n    \"bi-star-half\": a1,\n    \"bi-star\": a2\n  };\n};\nfunction ComicDetailsComponent_ng_container_1_ng_container_26_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"i\", 32);\n    i0.ɵɵlistener(\"click\", function ComicDetailsComponent_ng_container_1_ng_container_26_div_1_Template_i_click_1_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const star_r8 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r10.rateComic(star_r8));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const star_r8 = i0.ɵɵnextContext().$implicit;\n    const comic_r1 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction3(1, _c0, star_r8 <= comic_r1.averageRating, star_r8 - 0.5 === comic_r1.averageRating, star_r8 > comic_r1.averageRating));\n  }\n}\nfunction ComicDetailsComponent_ng_container_1_ng_container_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, ComicDetailsComponent_ng_container_1_ng_container_26_div_1_Template, 2, 5, \"div\", 30);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const comic_r1 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", comic_r1);\n  }\n}\nconst _c1 = function (a1) {\n  return [\"/comic\", a1];\n};\nfunction ComicDetailsComponent_ng_container_1_li_48_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 33)(1, \"div\", 34)(2, \"span\", 35);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\")(6, \"span\", 36);\n    i0.ɵɵtext(7, \"6 pages\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"span\", 37);\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"date\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const c_r16 = ctx.$implicit;\n    const i_r17 = ctx.index;\n    let tmp_2_0;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(7, _c1, c_r16.id));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"#\", i_r17 + 1, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", (tmp_2_0 = c_r16 == null ? null : c_r16.name) !== null && tmp_2_0 !== undefined ? tmp_2_0 : \" no data\", \" #Previews \");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(10, 4, c_r16 == null ? null : c_r16.onSaleDate, \"dd/MM/yyyy\"));\n  }\n}\nfunction ComicDetailsComponent_ng_container_1_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 38)(1, \"div\", 39)(2, \"h4\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"div\", 40);\n    i0.ɵɵelementStart(5, \"div\", 41)(6, \"span\");\n    i0.ɵɵtext(7, \"5\\u2B50\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"span\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"div\", 42);\n    i0.ɵɵelement(11, \"div\", 43);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 41)(13, \"span\");\n    i0.ɵɵtext(14, \"4\\u2B50\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"span\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 42);\n    i0.ɵɵelement(18, \"div\", 43);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 41)(20, \"span\");\n    i0.ɵɵtext(21, \"3\\u2B50\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"span\");\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"div\", 42);\n    i0.ɵɵelement(25, \"div\", 43);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\", 41)(27, \"span\");\n    i0.ɵɵtext(28, \"2\\u2B50\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"span\");\n    i0.ɵɵtext(30);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(31, \"div\", 42);\n    i0.ɵɵelement(32, \"div\", 43);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"div\", 41)(34, \"span\");\n    i0.ɵɵtext(35, \"1\\u2B50\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"span\");\n    i0.ɵɵtext(37);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(38, \"div\", 44);\n    i0.ɵɵelement(39, \"div\", 43);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const comic_r1 = i0.ɵɵnextContext().ngIf;\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"User Ratings: \", comic_r1.averageRating > 0 ? comic_r1.averageRating + \" \\u2B50\" : \"Not rated yet\", \"\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.ratingsPercentage[5] > 0 ? ctx_r4.ratingsPercentage[5] : 0, \"%\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r4.ratingsPercentage[5] > 0 ? ctx_r4.ratingsPercentage[5] : 0, \"%\");\n    i0.ɵɵattribute(\"aria-valuenow\", ctx_r4.ratingsPercentage[5] > 0 ? ctx_r4.ratingsPercentage[5] : 0);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.ratingsPercentage[4] > 0 ? ctx_r4.ratingsPercentage[4] : 0, \"%\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r4.ratingsPercentage[4] > 0 ? ctx_r4.ratingsPercentage[4] : 0, \"%\");\n    i0.ɵɵattribute(\"aria-valuenow\", ctx_r4.ratingsPercentage[4] > 0 ? ctx_r4.ratingsPercentage[4] : 0);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.ratingsPercentage[3] > 0 ? ctx_r4.ratingsPercentage[3] : 0, \"%\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r4.ratingsPercentage[3] > 0 ? ctx_r4.ratingsPercentage[3] : 0, \"%\");\n    i0.ɵɵattribute(\"aria-valuenow\", ctx_r4.ratingsPercentage[3] > 0 ? ctx_r4.ratingsPercentage[3] : 0);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.ratingsPercentage[2] > 0 ? ctx_r4.ratingsPercentage[2] : 0, \"%\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r4.ratingsPercentage[2] > 0 ? ctx_r4.ratingsPercentage[2] : 0, \"%\");\n    i0.ɵɵattribute(\"aria-valuenow\", ctx_r4.ratingsPercentage[2] > 0 ? ctx_r4.ratingsPercentage[2] : 0);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r4.ratingsPercentage[1] > 0 ? ctx_r4.ratingsPercentage[1] : 0, \"%\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r4.ratingsPercentage[1] > 0 ? ctx_r4.ratingsPercentage[1] : 0, \"%\");\n    i0.ɵɵattribute(\"aria-valuenow\", ctx_r4.ratingsPercentage[1] > 0 ? ctx_r4.ratingsPercentage[1] : 0);\n  }\n}\nfunction ComicDetailsComponent_ng_container_1_app_user_comment_50_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-user-comment\", 45);\n    i0.ɵɵlistener(\"commentAdded\", function ComicDetailsComponent_ng_container_1_app_user_comment_50_Template_app_user_comment_commentAdded_0_listener($event) {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r19.onCommentAdded($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const comic_r1 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵproperty(\"comicId\", comic_r1.id);\n  }\n}\nfunction ComicDetailsComponent_ng_container_1_div_51_app_user_reply_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r24 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-user-reply\", 47);\n    i0.ɵɵlistener(\"commentAdded\", function ComicDetailsComponent_ng_container_1_div_51_app_user_reply_1_Template_app_user_reply_commentAdded_0_listener($event) {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r23 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r23.onCommentAdded($event));\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const comic_r1 = i0.ɵɵnextContext(2).ngIf;\n    i0.ɵɵproperty(\"comments\", comic_r1.comments)(\"comicId\", comic_r1.id);\n  }\n}\nfunction ComicDetailsComponent_ng_container_1_div_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ComicDetailsComponent_ng_container_1_div_51_app_user_reply_1_Template, 1, 2, \"app-user-reply\", 46);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const comic_r1 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", comic_r1.id);\n  }\n}\nfunction ComicDetailsComponent_ng_container_1_div_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 48)(1, \"h6\", 49);\n    i0.ɵɵtext(2, \" No comments available. \");\n    i0.ɵɵelementEnd()();\n  }\n}\nconst _c2 = function (a1) {\n  return [\"/comic/details/read\", a1];\n};\nconst _c3 = function (a0) {\n  return {\n    \"btn-success\": a0\n  };\n};\nconst _c4 = function () {\n  return [1, 2, 3, 4, 5];\n};\nfunction ComicDetailsComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r28 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 2)(2, \"div\", 3)(3, \"div\", 4);\n    i0.ɵɵelement(4, \"img\", 5);\n    i0.ɵɵelementStart(5, \"div\", 6)(6, \"button\", 7);\n    i0.ɵɵtext(7, \"Start Reading\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function ComicDetailsComponent_ng_container_1_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r28);\n      const comic_r1 = restoredCtx.ngIf;\n      const ctx_r27 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r27.toggleBookmark(comic_r1.id));\n    });\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"div\", 9)(11, \"div\");\n    i0.ɵɵelement(12, \"p\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\")(14, \"p\");\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\")(17, \"p\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(19, \"div\", 10)(20, \"h3\");\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"div\", 11)(23, \"span\", 12);\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"div\", 13);\n    i0.ɵɵtemplate(26, ComicDetailsComponent_ng_container_1_ng_container_26_Template, 2, 1, \"ng-container\", 14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(27, \"ul\", 15)(28, \"li\", 16)(29, \"button\", 17);\n    i0.ɵɵtext(30, \"Description\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(31, \"li\", 16)(32, \"button\", 18);\n    i0.ɵɵtext(33);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(34, \"li\", 16)(35, \"button\", 19);\n    i0.ɵɵtext(36, \"Comments\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(37, \"div\", 20)(38, \"div\", 21)(39, \"p\");\n    i0.ɵɵtext(40);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(41, \"div\", 22)(42, \"div\", 23)(43, \"h4\");\n    i0.ɵɵtext(44);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"button\", 24);\n    i0.ɵɵtext(46, \"Show from end\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(47, \"ul\", 25);\n    i0.ɵɵtemplate(48, ComicDetailsComponent_ng_container_1_li_48_Template, 11, 9, \"li\", 26);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(49, ComicDetailsComponent_ng_container_1_div_49_Template, 40, 21, \"div\", 27);\n    i0.ɵɵtemplate(50, ComicDetailsComponent_ng_container_1_app_user_comment_50_Template, 1, 1, \"app-user-comment\", 28);\n    i0.ɵɵtemplate(51, ComicDetailsComponent_ng_container_1_div_51_Template, 2, 1, \"div\", 1);\n    i0.ɵɵtemplate(52, ComicDetailsComponent_ng_container_1_div_52_Template, 3, 0, \"div\", 29);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const comic_r1 = ctx.ngIf;\n    const ctx_r0 = i0.ɵɵnextContext();\n    let tmp_4_0;\n    let tmp_5_0;\n    let tmp_6_0;\n    let tmp_7_0;\n    let tmp_9_0;\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"src\", comic_r1.thumbnail ? comic_r1.thumbnail : \"assets/default-image.jpg\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(17, _c2, comic_r1.id));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(19, _c3, ctx_r0.statusBookmark == null ? null : ctx_r0.statusBookmark.isSave));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", (ctx_r0.statusBookmark == null ? null : ctx_r0.statusBookmark.isSave) ? \"Bookmarked\" : \"Add to Bookmarks\", \" \");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate((tmp_4_0 = comic_r1 == null ? null : comic_r1.comicCategory == null ? null : comic_r1.comicCategory.name) !== null && tmp_4_0 !== undefined ? tmp_4_0 : \"no data\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate((tmp_5_0 = comic_r1 == null ? null : comic_r1.onSaleDate) !== null && tmp_5_0 !== undefined ? tmp_5_0 : \"no data\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate((tmp_6_0 = comic_r1 == null ? null : comic_r1.name) !== null && tmp_6_0 !== undefined ? tmp_6_0 : \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", (tmp_7_0 = comic_r1 == null ? null : comic_r1.ratings == null ? null : comic_r1.ratings.length) !== null && tmp_7_0 !== undefined ? tmp_7_0 : 0, \" Ratings\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpureFunction0(21, _c4));\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"Chapters (\", (tmp_9_0 = comic_r1 == null ? null : comic_r1.relatedComics == null ? null : comic_r1.relatedComics.length) !== null && tmp_9_0 !== undefined ? tmp_9_0 : 1, \")\");\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\" \", comic_r1.description, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Read comics \", comic_r1.name, \" online free\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", comic_r1.relatedComics);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.ratingsPercentage);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", comic_r1.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", comic_r1.comments == null ? null : comic_r1.comments.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !(comic_r1.comments == null ? null : comic_r1.comments.length));\n  }\n}\nlet ComicDetailsComponent = /*#__PURE__*/(() => {\n  class ComicDetailsComponent {\n    constructor(route, bookmarkService, comicService, router, cookieService, authService, toastr, ratingService) {\n      this.route = route;\n      this.bookmarkService = bookmarkService;\n      this.comicService = comicService;\n      this.router = router;\n      this.cookieService = cookieService;\n      this.authService = authService;\n      this.toastr = toastr;\n      this.ratingService = ratingService;\n      this.id = null;\n      //comic?: Comic\n      this.comic$ = new BehaviorSubject(null);\n      this.ratingStars = {};\n      this.ratingsPercentage = {\n        1: 0,\n        2: 0,\n        3: 0,\n        4: 0,\n        5: 0\n      };\n      //applicationUserId='80bc701a-c88d-4b4c-8ff5-a85eb79e563f';\n      this.bookmarkModel = {\n        isSave: false,\n        isRead: false,\n        isCurrentlyReading: false\n      };\n    }\n    rateComic(star) {\n      const comic = this.comic$.value;\n      const model = {\n        comicId: comic?.id,\n        applicationUserId: this.user?.applicationUserId,\n        score: star\n      };\n      if (this.user?.applicationUserId) {\n        this.ratingService.createRateComic(model).subscribe({\n          next: response => {\n            // console.log('?????',response);\n            this.toastr.success('Thanks for your rating!');\n          },\n          error: error => {\n            this.toastr.error('Failed to submit your rating. Please try again.');\n            //   console.error('Error submitting rating:', error);\n          }\n        });\n      } else {\n        this.toastr.warning('You must be logged in to use this feature!');\n      }\n    }\n    ngOnInit() {\n      this.user = this.authService.getUser();\n      this.route.paramMap.subscribe(params => {\n        this.id = params.get('id');\n        if (this.id) {\n          // Lấy trạng thái bookmark\n          this.bookmarkService.getStatusBookmark(this.user?.applicationUserId, Number(this.id)).subscribe(response => {\n            this.statusBookmark = response;\n          });\n          // Lấy thông tin comic\n          this.comicService.getComicById(this.id).subscribe({\n            next: response => {\n              //   console.log('response comicById',response );\n              this.comic$.next(response);\n              if (response.ratings && Array.isArray(response.ratings)) {\n                this.ratingsPercentage = this.calculateRatings(response.ratings);\n              }\n            },\n            error: err => {}\n          });\n        }\n      });\n    }\n    // Helper function để tìm bình luận theo ID\n    findCommentById(comments, commentId) {\n      for (let comment of comments) {\n        if (comment.commentId === commentId) {\n          return comment;\n        }\n        if (comment.replies) {\n          const foundInReplies = this.findCommentById(comment.replies, commentId);\n          if (foundInReplies) {\n            return foundInReplies;\n          }\n        }\n      }\n      return undefined;\n    }\n    onCommentAdded(newComment) {\n      const currentComic = this.comic$.value; // Lấy comic hiện tại      \n      //  console.log('newComment', newComment);\n      if (currentComic) {\n        if (newComment.parentCommentId) {\n          // Nếu đây là bình luận trả lời, tìm bình luận cha và thêm vào mảng replies\n          const parentComment = this.findCommentById(currentComic.comments, newComment.parentCommentId);\n          if (parentComment) {\n            parentComment.replies = parentComment.replies || [];\n            parentComment.replies.push(newComment); // Thêm bình luận vào mảng replies của bình luận cha\n          }\n        } else {\n          //   console.log('newComment', newComment);    \n          currentComic.comments.push(newComment);\n        }\n        // Cập nhật lại comic$ và trigger Angular kiểm tra thay đổi\n        this.comic$.next({\n          ...currentComic\n        });\n      }\n    }\n    toggleBookmark(comicId) {\n      // Kiểm tra trạng thái hiện tại của bookmark (isSave)\n      if (this.statusBookmark?.isSave) {\n        this.bookmarkModel.isSave = false; // Đổi trạng thái thành chưa lưu\n      } else {\n        this.bookmarkModel.isSave = true; // Đổi trạng thái thành đã lưu\n      }\n      //   console.log('Trạng thái hiện tại:', this.statusBookmark?.isSave);\n      //  console.log('Cập nhật trạng thái isSave:', this.bookmarkModel.isSave);\n      // Gọi API AddOrUpdate để lưu trạng thái\n      if (this.user?.applicationUserId) {\n        this.bookmarkService.addOrUpdateBookmark(this.user.applicationUserId, comicId, this.bookmarkModel).subscribe({\n          next: response => {\n            //     console.log('Bookmark successfully added or updated', response);\n            // Sau khi cập nhật thành công, cập nhật lại statusBookmark\n            this.statusBookmark = {\n              ...this.statusBookmark,\n              isSave: this.bookmarkModel.isSave\n            }; // cú pháp spread operator (...) \n          },\n\n          error: err => {\n            if (err.status === 401) {\n              this.toastr.warning('Bạn không có quyền truy cập chức năng này');\n            }\n            console.error('Failed to add or update bookmark:', err);\n          }\n        });\n      } else {\n        this.toastr.warning('You must be logged in to use this feature!');\n      }\n    }\n    calculateRatings(ratings) {\n      // Kiểm tra ratings là mảng hợp lệ\n      if (Array.isArray(ratings) && ratings.length > 0) {\n        // Khai báo kiểu cho ratingsCount\n        const ratingsCount = {\n          1: 0,\n          2: 0,\n          3: 0,\n          4: 0,\n          5: 0\n        };\n        let totalRatings = 0;\n        // Đếm số lượng mỗi rating\n        ratings.forEach(rating => {\n          if (rating.score >= 1 && rating.score <= 5) {\n            ratingsCount[rating.score]++; // Tăng số lượng rating\n            totalRatings++; // Tăng tổng số rating\n          }\n        });\n        // Kiểm tra nếu không có rating nào để tránh chia cho 0\n        if (totalRatings === 0) {\n          //     console.error('No valid ratings found');\n          return ratingsCount; // Trả về mặc định nếu không có rating hợp lệ\n        }\n        // Khai báo kiểu cho ratingsPercentage\n        const ratingsPercentage = {\n          1: 0,\n          2: 0,\n          3: 0,\n          4: 0,\n          5: 0\n        };\n        // Tính phần trăm cho mỗi rating\n        Object.keys(ratingsCount).forEach(key => {\n          const numberKey = Number(key); // Chuyển key sang number\n          const percentage = ratingsCount[numberKey] / totalRatings * 100;\n          ratingsPercentage[numberKey] = parseFloat(percentage.toFixed(2)); // Làm tròn phần trăm\n        });\n\n        console.log(\"Kết quả tính phần trăm rating:\", ratingsPercentage);\n        return ratingsPercentage; // Trả về kết quả phần trăm\n      } else {\n        //   console.error('Invalid or empty ratings array');\n        return {}; // Nếu không phải mảng hợp lệ hoặc mảng trống, trả về đối tượng trống\n      }\n    }\n\n    scrollToTop() {\n      window.scrollTo({\n        top: 0,\n        behavior: 'smooth'\n      });\n    }\n    ngOnDestroy() {\n      this.paramsSubscription?.unsubscribe();\n      this.statusBookmarkSubscription?.unsubscribe();\n    }\n    static {\n      this.ɵfac = function ComicDetailsComponent_Factory(t) {\n        return new (t || ComicDetailsComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.BookmarksService), i0.ɵɵdirectiveInject(i3.ComicService), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i4.CookieService), i0.ɵɵdirectiveInject(i5.AuthService), i0.ɵɵdirectiveInject(i6.ToastrService), i0.ɵɵdirectiveInject(i7.RatingService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ComicDetailsComponent,\n        selectors: [[\"app-comic-details\"]],\n        decls: 3,\n        vars: 3,\n        consts: [[1, \"container\"], [4, \"ngIf\"], [1, \"row\"], [1, \"col-md-4\", \"comic-image\", \"text-center\"], [1, \"action-wrapper\", 2, \"max-width\", \"300px\", \"margin\", \"0 auto\"], [1, \"img-fluid\", 3, \"src\"], [1, \"d-flex\", \"flex-column\", \"gap-2\", \"mt-3\"], [1, \"btn\", \"btn-custom\", \"w-100\", 3, \"routerLink\"], [1, \"btn\", \"btn-outline-light\", \"w-100\", 3, \"ngClass\", \"click\"], [1, \"d-flex\", \"gap-3\", \"mt-3\"], [1, \"col-md-8\", \"comic-card\"], [1, \"rating-container\", \"d-flex\", \"align-items-center\", \"gap-2\"], [1, \"rating-text\"], [1, \"stars\"], [4, \"ngFor\", \"ngForOf\"], [\"id\", \"comicTabs\", \"role\", \"tablist\", 1, \"nav\", \"nav-tabs\"], [\"role\", \"presentation\", 1, \"nav-item\"], [\"id\", \"description-tab\", \"data-bs-toggle\", \"tab\", \"data-bs-target\", \"#description\", \"type\", \"button\", \"role\", \"tab\", \"aria-controls\", \"description\", \"aria-selected\", \"true\", 1, \"nav-link\", \"active\"], [\"id\", \"chapters-tab\", \"data-bs-toggle\", \"tab\", \"data-bs-target\", \"#chapters\", \"type\", \"button\", \"role\", \"tab\", \"aria-controls\", \"chapters\", \"aria-selected\", \"false\", 1, \"nav-link\"], [\"id\", \"comments-tab\", \"data-bs-toggle\", \"tab\", \"data-bs-target\", \"#comments\", \"type\", \"button\", \"role\", \"tab\", \"aria-controls\", \"comments\", \"aria-selected\", \"false\", 1, \"nav-link\"], [1, \"tab-content\", \"mt-3\"], [\"id\", \"description\", \"role\", \"tabpanel\", \"aria-labelledby\", \"description-tab\", 1, \"tab-pane\", \"fade\", \"show\", \"active\"], [\"id\", \"chapters\", \"role\", \"tabpanel\", \"aria-labelledby\", \"chapters-tab\", 1, \"tab-pane\", \"fade\"], [1, \"chapter-list\", \"mt-3\"], [1, \"btn\", \"btn-outline-secondary\", \"btn-sm\", \"mt-2\"], [1, \"list-group\", \"mt-3\"], [\"class\", \"list-group-item d-flex justify-content-between align-items-center\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"col-md-12 mt-3\", 4, \"ngIf\"], [3, \"comicId\", \"commentAdded\", 4, \"ngIf\"], [\"class\", \"no-comments\", 4, \"ngIf\"], [\"style\", \"cursor: pointer;\", 4, \"ngIf\"], [2, \"cursor\", \"pointer\"], [1, \"bi\", 3, \"ngClass\", \"click\"], [1, \"list-group-item\", \"d-flex\", \"justify-content-between\", \"align-items-center\"], [3, \"routerLink\"], [1, \"badge\", \"bg-dark\", \"me-2\"], [1, \"text-muted\", \"me-3\"], [1, \"text-muted\"], [1, \"col-md-12\", \"mt-3\"], [1, \"p-3\", 2, \"background-color\", \"#1e1e1e\", \"border-radius\", \"5px\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\"], [1, \"d-flex\", \"justify-content-between\"], [1, \"progress\", \"mb-3\"], [\"role\", \"progressbar\", \"aria-valuemin\", \"0\", \"aria-valuemax\", \"100\", 1, \"progress-bar\"], [1, \"progress\"], [3, \"comicId\", \"commentAdded\"], [3, \"comments\", \"comicId\", \"commentAdded\", 4, \"ngIf\"], [3, \"comments\", \"comicId\", \"commentAdded\"], [1, \"no-comments\"], [1, \"text-white\", \"mt-3\"]],\n        template: function ComicDetailsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0);\n            i0.ɵɵtemplate(1, ComicDetailsComponent_ng_container_1_Template, 53, 22, \"ng-container\", 1);\n            i0.ɵɵpipe(2, \"async\");\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(2, 1, ctx.comic$));\n          }\n        },\n        dependencies: [i8.NgClass, i8.NgForOf, i8.NgIf, i1.RouterLink, i9.UserReplyComponent, i10.UserCommentComponent, i8.AsyncPipe, i8.DatePipe],\n        styles: [\".comic-card[_ngcontent-%COMP%]{padding:20px;border-radius:8px}.comic-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50vh;border-radius:8px}.btn-custom[_ngcontent-%COMP%]{background-color:#fc0;color:#000;font-weight:700}.btn-custom[_ngcontent-%COMP%]:hover{background-color:#fa0}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:#fff}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{background-color:#fc0;color:#000;font-weight:700}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:#fc0}.tab-content[_ngcontent-%COMP%]{background-color:#1e1e1e;padding:20px;border-radius:8px}.chapter-list[_ngcontent-%COMP%]{background-color:#1c1c1c;color:#fff;padding:15px;border-radius:8px;cursor:pointer}.list-group-item[_ngcontent-%COMP%]{background-color:#292929;color:#fff;border:none}.list-group-item[_ngcontent-%COMP%]:hover{background-color:#333}.badge.bg-dark[_ngcontent-%COMP%]{font-size:14px;padding:5px 10px}.text-muted[_ngcontent-%COMP%]{font-size:14px}span[_ngcontent-%COMP%]{color:#bdc3c7!important}.rating-container[_ngcontent-%COMP%]{color:#fff}.rating-text[_ngcontent-%COMP%]{font-size:14px;color:#bdc3c7}.stars[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center}.stars[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px;font-size:1.5rem;color:gold}p[_ngcontent-%COMP%]{color:#bdc3c7}.progress-bar[_ngcontent-%COMP%]{background-color:#ffc107}ul[_ngcontent-%COMP%]{list-style:none}\"]\n      });\n    }\n  }\n  return ComicDetailsComponent;\n})();\nexport { ComicDetailsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}